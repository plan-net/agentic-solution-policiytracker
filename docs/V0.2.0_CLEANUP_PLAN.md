# v0.2.0 Comprehensive Cleanup Plan

## Overview
This document outlines the comprehensive cleanup strategy to transition from the legacy v0.1.0 political monitoring system to the new v0.2.0 ETL + Flows + Chat architecture. The cleanup will remove approximately 60-70% of the current codebase while preserving the three core capabilities.

## Architecture Evolution Summary

### OLD v0.1.0 System (TO REMOVE)
- **Monolithic political analyzer** with single LangGraph workflow
- **Ray-based processing** with hardcoded document paths
- **Hybrid scoring engines** for relevance and priority classification
- **Template-based report generation** with Jinja2
- **Single Kodosumi endpoint** calling political_analyzer.py

### NEW v0.2.0 System (TO KEEP)
- **ETL Pipeline**: Airflow DAGs + collectors (Exa, Apify) + storage abstraction
- **Flow Architecture**: Kodosumi flows for data processing + Graphiti integration
- **Chat Interface**: Multi-agent system with OpenAI API + knowledge graph tools

## Cleanup Strategy: 4 Phases

---

## **PHASE 1: Core Legacy Removal** 
*Priority: CRITICAL | Estimated Impact: ~40% of codebase*

### 1.1 Remove Main Legacy Application Files
```bash
# Complete removal - these are entirely replaced
src/app.py                    # OLD Kodosumi endpoint → Replace with flows
src/political_analyzer.py     # OLD main entrypoint → Archive
```

### 1.2 Remove Old Workflow System
```bash
# Entire directories - replaced by ETL + Chat agents
src/workflow/                 # OLD LangGraph workflow
├── graph.py                 # → Replaced by multi-agent system
├── nodes.py                 # → Replaced by flow nodes + chat agents
└── state.py                 # → Replaced by flow states + agent states
```

### 1.3 Remove Old Analysis Components
```bash
# Functionality moved to GraphRAG and flows
src/analysis/                 # OLD analysis system
├── aggregator.py            # → Replaced by graph queries
├── priority_classifier.py   # → Replaced by agent reasoning
└── topic_clusterer.py       # → Replaced by graph communities
```

### 1.4 Remove Old Scoring System
```bash
# Replaced by graph-based relevance and agent assessment
src/scoring/                  # OLD hybrid scoring engine
├── hybrid_engine.py         # → Replaced by graph similarity
├── relevance_engine.py      # → Replaced by semantic search
├── dimensions.py            # → Replaced by agent evaluation
├── confidence.py            # → Replaced by agent confidence
└── justification.py         # → Replaced by agent reasoning
```

---

## **PHASE 2: Legacy Infrastructure Removal**
*Priority: HIGH | Estimated Impact: ~25% of codebase*

### 2.1 Remove Old Processing System
```bash
src/pipeline/                 # OLD document processing
└── document_processor.py    # → Replaced by ETL transformers

src/processors/              # OLD batch processing
├── batch_loader.py          # → Replaced by ETL collectors
├── content_processor.py     # → Replaced by flow processors
└── document_reader.py       # → Replaced by ETL storage
```

### 2.2 Remove Old Output System
```bash
src/output/                   # OLD report generation
├── formatter.py             # → Replaced by flow outputs
├── report_generator.py      # → Replaced by chat responses
└── templates/               # → Replaced by agent responses
    ├── cluster.md.j2        # → No longer needed
    ├── report.md.j2         # → No longer needed
    └── summary.md.j2        # → No longer needed
```

### 2.3 Remove Old Model System
```bash
src/models/                   # OLD data models
├── content.py               # → Replaced by graph entities
├── report.py                # → Replaced by flow outputs
├── scoring.py               # → Replaced by agent evaluation
└── job.py                   # → KEEP (still used in legacy tests)
```

### 2.4 Remove Legacy Integration Components
```bash
src/integrations/            # Assess individually
├── azure_checkpoint.py     # → Likely obsolete (old LangGraph checkpointing)
└── azure_storage.py        # → Potentially keep if used by ETL
```

---

## **PHASE 3: Documentation & Configuration Cleanup**
*Priority: MEDIUM | Estimated Impact: ~15% of codebase*

### 3.1 Remove Legacy Documentation
```bash
docs/V0_1_0_RELEASE_CHECKLIST.md  # → Archive
docs/TODO.md                      # → Update or remove (contains v0.1.0 tasks)
docs/CLEANUP_SUMMARY.md           # → Outdated cleanup summary
docs/PHASE_3_COMPLETION.md        # → Keep (recent phase completion)
docs/PHASE_3_ORCHESTRATION_COMPLETE.md  # → Keep
docs/PHASE_4_COMPLETION.md        # → Keep
docs/PHASE_5_COMPLETION_SUMMARY.md     # → Keep
```

### 3.2 Remove Outdated Specifications
```bash
docs/specs/                   # Assess each file
├── kodosumi.md              # → Likely OLD v0.1.0 spec
├── requirements.md          # → Likely OLD requirements
├── specification.md         # → Likely OLD specification
├── briefing.md              # → Assess if still relevant
└── architecture.md          # → Update to reflect v0.2.0
```

### 3.3 Update Core Documentation
```bash
# Files to UPDATE (not remove)
README.md                     # → Update to reflect v0.2.0 architecture
CLAUDE.md                     # → Update project context
docs/USER_GUIDE.md          # → Update for new flows + chat
docs/QUICK_REFERENCE.md     # → Update commands and capabilities
```

### 3.4 Update Configuration Templates
```bash
# Assess and clean up configuration
config.yaml.template          # → Update to remove legacy Ray actors
docker-compose.yml            # → Ensure only v0.2.0 services
pyproject.toml               # → Remove unused dependencies
```

---

## **PHASE 4: Test Suite Cleanup**
*Priority: MEDIUM | Estimated Impact: ~20% of test files*

### 4.1 Remove Legacy Integration Tests
```bash
tests/integration/
├── test_political_analyzer.py      # → REMOVE (tests old analyzer)
├── test_workflow_execution.py      # → REMOVE (tests old workflow)
├── test_end_to_end_workflow.py     # → REMOVE (tests old workflow)
└── test_complete_multi_agent_workflow.py  # → KEEP (tests new system)
```

### 4.2 Remove Legacy Unit Tests
```bash
tests/unit/
├── test_workflow_nodes.py          # → REMOVE (old workflow)
├── test_workflow_orchestration.py  # → REMOVE (old workflow)
├── test_scoring.py                 # → REMOVE (old scoring)
├── test_individual_agents.py       # → ASSESS (might be new system)
├── test_orchestrator.py           # → ASSESS (might be new system)
└── test_phase4_enhancements.py    # → KEEP (new system)
```

### 4.3 Clean Up Test Fixtures
```bash
tests/fixtures/
├── documents.py             # → Update for new system
└── etl_fixtures.py          # → KEEP (new ETL system)

tests/mocks/
├── memory_components.py     # → ASSESS relevance
└── knowledge_graph_tools.py # → KEEP (new system)
```

### 4.4 Remove Legacy Test Scripts
```bash
scripts/_dev_testing/        # Assess each file
├── test_etl_*              # → KEEP (new system)
├── test_policy_simple.py   # → KEEP (new system)
├── test_graphrag_*         # → KEEP (new system)
├── etl_test_summary.py     # → KEEP (new system)
└── process_*               # → ASSESS individually
```

---

## **PRESERVATION CHECKLIST**

### ✅ **MUST KEEP - Core v0.2.0 Capabilities**

#### ETL System (Complete)
```bash
src/etl/                     # ✅ KEEP - Core ETL pipeline
├── collectors/              # ✅ KEEP - Data collection (Exa, Apify)
├── dags/                    # ✅ KEEP - Airflow orchestration
├── storage/                 # ✅ KEEP - Storage abstraction
├── transformers/            # ✅ KEEP - Data transformation
└── utils/                   # ✅ KEEP - ETL utilities
```

#### Flow System (Core)
```bash
src/flows/                   # ✅ KEEP - Kodosumi flows
├── data_ingestion/          # ✅ KEEP - Flow 1 (Document → Graphiti)
└── shared/                  # ✅ KEEP - Shared flow components
```

#### Chat Interface (Complete)
```bash
src/chat/                    # ✅ KEEP - Multi-agent chat system
├── agent/                   # ✅ KEEP - LangGraph agents
├── server/                  # ✅ KEEP - OpenAI API server
└── tools/                   # ✅ KEEP - Knowledge graph tools
```

#### GraphRAG System
```bash
src/graphrag/                # ✅ KEEP - Graph processing
├── graphiti_config.py       # ✅ KEEP - Graphiti setup
├── mcp_graphiti_client.py   # ✅ KEEP - MCP integration
└── political_schema_v2.py   # ✅ KEEP - Graph schema
```

#### Core Infrastructure
```bash
src/config.py               # ✅ KEEP - Configuration system
src/utils/                   # ✅ KEEP - Utilities (logging, exceptions)
src/llm/                     # ✅ KEEP - LLM services
```

### ✅ **KEEP - Supporting Infrastructure**

#### Configuration & Deployment
```bash
config.yaml.template         # ✅ UPDATE - Remove legacy references
docker-compose.yml           # ✅ KEEP - v0.2.0 services
justfile                     # ✅ KEEP - v0.2.0 commands
pyproject.toml              # ✅ UPDATE - Remove unused deps
```

#### Documentation (v0.2.0 Relevant)
```bash
docs/specs/v0.2.0-*         # ✅ KEEP - Current specifications
docs/PHASE_*_COMPLETION.md  # ✅ KEEP - Recent phase docs
docs/OPEN_WEBUI_SETUP.md    # ✅ KEEP - Chat interface setup
docs/SEARCH_CAPABILITIES.md # ✅ KEEP - Graph capabilities
docs/graph.md               # ✅ KEEP - Graph documentation
docs/langfuse.md            # ✅ KEEP - Observability setup
```

#### Tests (v0.2.0 System)
```bash
tests/integration/test_etl_pipeline.py           # ✅ KEEP
tests/integration/test_multi_agent_workflow.py   # ✅ KEEP
tests/unit/test_etl_collectors.py               # ✅ KEEP
tests/deployment/                                # ✅ KEEP
```

---

## **EXECUTION PLAN**

### Pre-Cleanup Validation
1. **Run full test suite** to ensure v0.2.0 system works
2. **Verify ETL pipeline** can collect and process data
3. **Test chat interface** can query knowledge graph
4. **Backup current state** before any deletions

### Cleanup Execution Order
1. **Phase 1**: Remove core legacy files (can be done safely)
2. **Phase 2**: Remove legacy infrastructure (check dependencies)
3. **Phase 3**: Update documentation and configuration
4. **Phase 4**: Clean up test suite

### Post-Cleanup Tasks
1. **Update imports** and remove unused dependencies
2. **Run formatting and type checking** (`just format && just typecheck`)
3. **Update version references** from v0.1.0 to v0.2.0
4. **Test complete system** after cleanup
5. **Update CLAUDE.md** to reflect new architecture

---

## **RISK MITIGATION**

### High Risk Areas
- **Configuration files**: May have hidden dependencies
- **Shared utilities**: Might be used by both old and new systems
- **Test fixtures**: May be referenced by kept tests

### Validation Steps
1. **Search for imports** before deleting any file
2. **Run tests after each phase** to catch broken dependencies
3. **Grep for file references** in configuration and documentation
4. **Keep git history** for easy rollback if needed

### Emergency Rollback
- Each phase should be a separate commit
- Tag current state before starting cleanup
- Document any manual steps for rollback

---

## **SUCCESS CRITERIA**

### Codebase Metrics
- [ ] **~60-70% reduction** in total lines of code
- [ ] **Remove ~40+ files** of legacy code
- [ ] **Zero references** to removed components
- [ ] **All tests passing** for v0.2.0 system

### Functional Validation
- [ ] **ETL pipeline** successfully collects and processes data
- [ ] **Flows** can ingest documents into Graphiti/Neo4j
- [ ] **Chat interface** responds to queries with graph data
- [ ] **Documentation** accurately reflects v0.2.0 architecture

### Quality Gates
- [ ] **No unused imports** or dependencies
- [ ] **Type checking passes** (`just typecheck`)
- [ ] **Code formatting** is consistent (`just format`)
- [ ] **All configuration** references are valid

---

## **TIMELINE ESTIMATE**

- **Phase 1**: 2-3 hours (safe deletions)
- **Phase 2**: 3-4 hours (dependency checking)
- **Phase 3**: 2-3 hours (documentation updates)
- **Phase 4**: 2-3 hours (test cleanup)
- **Total**: 1-2 days for complete cleanup

---

## **NEXT STEPS**

1. **Review and approve** this cleanup plan
2. **Execute pre-cleanup validation** steps
3. **Begin Phase 1** with core legacy removal
4. **Progress through phases** with validation at each step
5. **Complete post-cleanup tasks** and testing

This cleanup will result in a much cleaner, more maintainable codebase focused entirely on the v0.2.0 architecture of ETL → Flows → Chat.